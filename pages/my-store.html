<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Mini Store | Trendy Stores</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    main {
      flex: 1;
    }
    .cart-img {
      width: 100px;
      height: auto;
      object-fit: cover;
    }
    .cart-item {
      border-bottom: 1px solid #eee;
      padding: 15px 0;
    }
    .quantity-btn {
      padding: 0 10px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<!-- Header -->
<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="#">Trendy Stores</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li><a href="../index.html" class="nav-link">Home</a></li>
        <li><a href="../pages/about.html" class="nav-link">About Us</a></li>
        <li><a href="../pages/contact.html" class="nav-link">Contact</a></li>
        <li><a href="../pages/blog.html" class="nav-link">Blog</a></li>
        <li><a href="#" class="nav-link active">My Mini Store</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Main Content -->
<main class="container my-5">
<h3 class="mb-4">
    <img src="../images/online-store (1).gif" alt="Store Icon" width="30" height="30" class="me-2">
    My Mini Store
</h3>
  <div id="cart-items"></div>
  <div class="text-end mt-4">
    <h5>Total: Ksh<span id="total-price">0.00</span></h5>
    <button class="btn btn-success mt-2">Proceed to payment</button> <!--add the purchase logic--> 
  </div>
</main>

<!-- Footer -->
<footer class="bg-light py-4 mt-auto">
  <div class="container text-center">
    <small>&copy; 2025 Trendy Stores. All rights reserved.</small>
  </div>
</footer>

<script>
function renderCart() {
  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  const cartItemsContainer = document.getElementById('cart-items');
  const totalPriceContainer = document.getElementById('total-price');
  cartItemsContainer.innerHTML = '';

  let total = 0;

  if (cart.length === 0) {
    cartItemsContainer.innerHTML = '<p>Your cart is empty !.</p>';
    totalPriceContainer.textContent = '0.00';
    return;
  }

  cart.forEach((item, index) => {
    // Use preferred image IDs if available, fallback to item.image
    let imageSrc = item.image;
    if (!imageSrc && item.productName) {
      const match = item.productName.match(/\d+/);
      if (match) {
        imageSrc = `../images/${match[0]}.jpeg`;
      }
    }

    // Default quantity to 1 if not present
    if (!item.quantity) item.quantity = 1;

    const itemTotal = item.price * item.quantity;
    total += itemTotal;

    const itemHTML =
     `
      <div class="row cart-item align-items-center">
        <div class="col-md-2">
          <img src="${imageSrc}" class="cart-img img-thumbnail" alt="${item.productName || item.name}">
        </div>
        <div class="col-md-3">
          <h6>${item.productName || item.name}</h6>
          <p class="text-muted">Ksh${item.price.toFixed(2)}</p>
        </div>
        <div class="col-md-3 d-flex align-items-center">
          <button class="btn btn-sm btn-outline-secondary quantity-btn" onclick="updateQuantity(${index}, -1)">âˆ’</button>
          <span class="mx-2">${item.quantity}</span>
          <button class="btn btn-sm btn-outline-secondary quantity-btn" onclick="updateQuantity(${index}, 1)">+</button>
        </div>
        <div class="col-md-2 text-end">
          <strong>Ksh${itemTotal.toFixed(2)}</strong>
        </div>
        <div class="col-md-2 text-end">
          <button class="btn btn-sm btn-danger" onclick="removeItem(${index})">Remove</button>
        </div>
      </div>
    `;
    cartItemsContainer.innerHTML += itemHTML;
  });

  totalPriceContainer.textContent = total.toFixed(2);
}

function updateQuantity(index, change) {
  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  if (!cart[index].quantity) cart[index].quantity = 1;
  cart[index].quantity += change;

  if (cart[index].quantity <= 0) {
    cart.splice(index, 1); // Remove item if quantity is 0
  }

  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
}

function removeItem(index) {
  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  cart.splice(index, 1);
  localStorage.setItem('cart', JSON.stringify(cart));
  renderCart();
}

window.onload = renderCart;
</script>

</body>
</html>
